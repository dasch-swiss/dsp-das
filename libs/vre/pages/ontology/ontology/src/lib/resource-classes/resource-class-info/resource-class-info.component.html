<mat-card
  (mouseenter)="classHovered = true"
  (mouseleave)="classHovered = false"
  data-cy="class-card"
  appearance="outlined"
  class="resource-class"
  cdkDrag
  cdkDragBoundary=".drag-drop-stop">
  <mat-card-header class="resource-class-header" cdkDragHandle>
    <mat-card-title [matTooltip]="this.resourceClass.comments | appStringifyStringLiteral" matTooltipPosition="above">
      {{ this.resourceClass.labels | appStringifyStringLiteral | appTruncate: 56 }}
    </mat-card-title>
    <mat-card-subtitle>
      <span class="mat-caption class-name"> {{ resourceClass.name }} </span>
      <span class="mat-caption">&nbsp;&middot;&nbsp;</span>
      <span class="mat-caption" data-cy="class-type-label"
        >@if (resourceClass.defaultClassIcon) {
        <mat-icon>{{ resourceClass.defaultClassIcon }}</mat-icon>
        } {{ resourceClass.defaultClassLabel }}
      </span>
    </mat-card-subtitle>
    <span class="resource-class-header-action">
      @if ((project$ | async)?.status) {
      <span class="resource-class-more">
        @if (classHovered || menuOpen) {
        <button
          mat-icon-button
          [matMenuTriggerFor]="resClassMenu"
          class="res-class-menu"
          data-cy="more-button"
          (menuOpened)="menuOpen = true"
          (menuClosed)="menuOpen = false"
          (click)="setCanBeDeleted()">
          <mat-icon>more_vert</mat-icon>
        </button>
        }
      </span>
      }
      <span class="resource-class-size" [matTooltip]="(expandClasses ? 'Collapse class' : 'Expand class')">
        <button mat-icon-button (click)="expandClasses = !expandClasses">
          <mat-icon>{{ expandClasses ? "expand_less" : "expand_more" }}</mat-icon>
        </button>
      </span>
    </span>
  </mat-card-header>
  <!-- resource class card content with list of properties -->
  @if (expandClasses) {
  <mat-card-content class="resource-class-content">
    @if (resourceClass.properties?.length) {
    <mat-list cdkDropList class="resource-class-properties" (cdkDropListDropped)="onPropertyDropped($event)">
      @for (prop of resourceClass.properties; track trackByPropToDisplayFn(i, prop); let i = $index) {
      <app-property-item [classProp]="prop" (cardinalityChange)="onCardinalityChange($event)" />
      }
    </mat-list>
    } @else {
    <p>There are no properties assigned to this class yet.</p>
    } @if ((hasProjectAdminRights$ | async)) {
    <app-add-property-menu [resourceClass]="resourceClass" />
    }
  </mat-card-content>
  }
</mat-card>

<mat-menu #resClassMenu="matMenu" xPosition="before">
  @if ((hasProjectAdminRights$ | async) === true && (project$ | async)?.status === true) {
  <button mat-menu-item class="res-class-edit" data-cy="edit-button" (click)="editResourceClassInfo()">
    <mat-icon>edit</mat-icon>
    Edit resource class info
  </button>
  }
  <button
    mat-menu-item
    (click)="openInDatabrowser()"
    [disabled]="classCanBeDeleted"
    data-cy="open-in-databrowser-button">
    <mat-icon>open_in_new</mat-icon>
    Open resource instances
  </button>
  <button mat-menu-item (click)="copyResourceClassId()" data-cy="copy-id-button">
    <mat-icon>content_copy</mat-icon>
    Copy resource class id
  </button>
  @if ((hasProjectAdminRights$ | async) === true && (project$ | async)?.status === true) {
  <button
    [matTooltip]="classCanBeDeleted ? '' : 'This class can\'t be deleted because it is in use'"
    matTooltipPosition="before"
    [disabled]="!classCanBeDeleted"
    (click)="deleteResourceClass()"
    mat-menu-item
    class="res-class-delete"
    data-cy="delete-button">
    <mat-icon>delete</mat-icon>
    Delete resource class
  </button>
  }
</mat-menu>
