<div class="adv-property-form-container">
  <mat-form-field class="adv-property-form">
    <mat-label>Property</mat-label>
    <mat-select
      #propertiesList
      (selectionChange)="onSelectedPropertyChanged($event)"
      data-cy="property-select"
      [compareWith]="compareObjects">
      <mat-option *ngIf="propertiesLoading$ | async" disabled="true">Loading...</mat-option>
      <ng-container *ngIf="!(propertiesLoading$ | async)">
        <mat-option [value]="resourceLabelObj" [attr.data-cy]="resourceLabelObj.label">
          {{ resourceLabelObj.label }}
        </mat-option>
        <mat-option *ngFor="let prop of filteredProperties$ | async" [value]="prop" [attr.data-cy]="prop.label">
          {{ prop.label }}
        </mat-option>
      </ng-container>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="adv-property-form right-hand-form">
    <mat-label>Comparison Operator</mat-label>
    <mat-select
      #operatorsList
      (selectionChange)="onSelectedOperatorChanged($event)"
      data-cy="comparison-operator-select">
      <mat-option *ngFor="let operator of propertyFormItem?.operators" [value]="operator" [attr.data-cy]="operator">
        {{ operator }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <div class="adv-property-form right-hand-form">
    <mat-form-field
      *ngIf="
        !propertyFormItem.selectedProperty?.objectType?.includes(constants.KnoraApiV2) &&
        propertyFormItem.selectedOperator === operators.Matches
      ">
      <mat-label>Resource Class</mat-label>
      <mat-select
        #resourceClassList
        (selectionChange)="onSelectedMatchPropertyResourceClassChanged($event)"
        data-cy="resource-class-select"
        [compareWith]="compareObjects">
        <mat-option *ngIf="matchResourceClassesLoading$ | async" disabled="true">Loading...</mat-option>
        <ng-container *ngIf="!(matchResourceClassesLoading$ | async)">
          <mat-option
            *ngFor="let resClass of propertyFormItem?.matchPropertyResourceClasses"
            [attr.data-cy]="resClass.label"
            [value]="resClass">
            {{ resClass.label }}
          </mat-option>
        </ng-container>
      </mat-select>
    </mat-form-field>

    <!-- Value forms -->
    <div
      *ngIf="
        propertyFormItem.selectedOperator &&
        propertyFormItem.selectedOperator !== operators.Exists &&
        propertyFormItem.selectedOperator !== operators.NotExists
      "
      class="adv-property-form">
      <app-property-form-value
        #propertyFormValue
        *ngIf="
          (propertyFormItem.selectedProperty?.objectType?.includes(constants.KnoraApiV2) ||
            propertyFormItem.selectedProperty?.objectType === constants.Label) &&
          propertyFormItem.selectedProperty?.objectType !== constants.ListValue
        "
        [objectType]="propertyFormItem.selectedProperty?.objectType"
        [value]="propertyFormItem.searchValue"
        (emitValueChanged)="onValueChanged($event)" />
      <app-property-form-list-value
        *ngIf="propertyFormItem.selectedProperty?.objectType === constants.ListValue"
        [list]="propertyFormItem.list"
        [value]="propertyFormItem.searchValue"
        (emitValueChanged)="onValueChanged($event)" />
      <app-property-form-link-value
        *ngIf="
          !propertyFormItem.selectedProperty?.objectType?.includes(constants.KnoraApiV2) &&
          propertyFormItem.selectedProperty?.objectType !== constants.Label &&
          propertyFormItem.selectedOperator !== operators.Matches"
        [value]="propertyFormItem.searchValue"
        [label]="propertyFormItem.searchValueLabel"
        [resourcesSearchResultsLoading]="resourcesSearchResultsLoading$ | async"
        [resourcesSearchResultsCount]="resourcesSearchResultsCount$ | async"
        [resourcesSearchResults]="resourcesSearchResults$ | async"
        [resourcesSearchNoResults]="resourcesSearchNoResults$ | async"
        (emitResourceSearchValueChanged)="onResourceSearchValueChanged($event)"
        (emitLoadMoreSearchResults)="onLoadMoreSearchResults($event)"
        (emitResourceSelected)="onValueChanged($event)" />
    </div>
  </div>
</div>
