<div class="parent-property-container">
  <div class="form-fields-container">
    <div class="dropdown-container">
      <div class="content">
        <mat-form-field>
          <mat-label>Property</mat-label>
          <mat-select
            #propertiesList
            (selectionChange)="onSelectedPropertyChanged($event)"
            appearance="fill"
            name="properties"
            data-cy="property-select"
            [compareWith]="compareObjects">
            @if (propertiesLoading) {
            <mat-option disabled="true">Loading...</mat-option>
            } @if (!propertiesLoading) {
            <mat-option [value]="resourceLabelObj" [attr.data-cy]="resourceLabelObj.label"
              >{{ resourceLabelObj.label }}
            </mat-option>
            @for (prop of properties; track prop) {
            <mat-option [value]="prop" [attr.data-cy]="prop.label"> {{ prop.label }} </mat-option>
            } }
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="dropdown-container">
      <div class="content">
        <mat-form-field class="operator">
          <mat-label>Comparison Operator</mat-label>
          <mat-select
            #operatorsList
            (selectionChange)="onSelectedOperatorChanged($event)"
            appearance="fill"
            data-cy="comparison-operator-select"
            name="operators">
            @for (operator of propertyFormItem?.operators; track operator) {
            <mat-option [value]="operator" [attr.data-cy]="operator"> {{ operator }} </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    @if ( !propertyFormItem.selectedProperty?.objectType?.includes( constants.KnoraApiV2 ) &&
    propertyFormItem.selectedOperator === operators.Matches ) {
    <div class="dropdown-container match-resource-class">
      <div class="content">
        <mat-form-field class="resource-class">
          <mat-label>Resource Class</mat-label>
          <mat-select
            #resourceClassList
            (selectionChange)="
                            onSelectedMatchPropertyResourceClassChanged($event)
                        "
            appearance="fill"
            name="resource-classes"
            data-cy="resource-class-select"
            [compareWith]="compareObjects">
            @if (matchResourceClassesLoading) {
            <mat-option disabled="true">Loading...</mat-option>
            } @if (!matchResourceClassesLoading) { @for (resClass of propertyFormItem?.matchPropertyResourceClasses;
            track resClass) {
            <mat-option [attr.data-cy]="resClass.label" [value]="resClass"> {{ resClass.label }} </mat-option>
            } }
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    } @if ( propertyFormItem.selectedOperator && propertyFormItem.selectedOperator !== operators.Exists &&
    propertyFormItem.selectedOperator !== operators.NotExists ) {
    <div class="value-container">
      @if ( (propertyFormItem.selectedProperty?.objectType?.includes( constants.KnoraApiV2 ) ||
      propertyFormItem.selectedProperty?.objectType === constants.Label) &&
      propertyFormItem.selectedProperty?.objectType !== constants.ListValue ) {
      <app-property-form-value
        #propertyFormValue
        [objectType]="propertyFormItem.selectedProperty?.objectType"
        [value]="propertyFormItem.searchValue"
        (emitValueChanged)="onValueChanged($event)" />
      } @if ( propertyFormItem.selectedProperty?.objectType === constants.ListValue ) {
      <app-property-form-list-value
        [list]="propertyFormItem.list"
        [value]="propertyFormItem.searchValue"
        (emitValueChanged)="onValueChanged($event)" />
      } @if ( !propertyFormItem.selectedProperty?.objectType?.includes( constants.KnoraApiV2 ) &&
      propertyFormItem.selectedProperty?.objectType !== constants.Label && propertyFormItem.selectedOperator !==
      operators.Matches ) {
      <app-property-form-link-value
        [value]="propertyFormItem.searchValue"
        [label]="propertyFormItem.searchValueLabel"
        [resourcesSearchResultsLoading]="resourcesSearchResultsLoading"
        [resourcesSearchResultsCount]="resourcesSearchResultsCount"
        [resourcesSearchResults]="resourcesSearchResults"
        [resourcesSearchNoResults]="resourcesSearchNoResults"
        (emitResourceSearchValueChanged)="
                    onResourceSearchValueChanged($event)
                "
        (emitLoadMoreSearchResults)="onLoadMoreSearchResults($event)"
        (emitResourceSelected)="onValueChanged($event)" />
      } @if ( !propertyFormItem.selectedProperty?.objectType?.includes( constants.KnoraApiV2 ) &&
      propertyFormItem.selectedProperty?.objectType !== constants.Label && propertyFormItem.selectedOperator ===
      operators.Matches && propertyFormItem.selectedMatchPropertyResourceClass ) {
      <app-property-form-link-match-property
        [values]="
                    getLinkMatchPropertyFormItems(propertyFormItem.searchValue)
                "
        [properties]="propertyFormItem.childPropertiesList"
        [resourcesSearchResultsLoading]="resourcesSearchResultsLoading"
        [resourcesSearchResultsCount]="resourcesSearchResultsCount"
        [resourcesSearchResults]="resourcesSearchResults"
        [resourcesSearchNoResults]="resourcesSearchNoResults"
        (emitAddPropertyForm)="onAddChildPropertyFormClicked()"
        (emitRemovePropertyForm)="
                    onRemoveChildPropertyFormClicked($event)
                "
        (emitSelectedPropertyChanged)="
                    onChildSelectedPropertyChanged($event)
                "
        (emitSelectedOperatorChanged)="
                    onChildSelectedOperatorChanged($event)
                "
        (emitValueChanged)="onChildValueChanged($event)"
        (emitResourceSearchValueChanged)="
                    onChildResourceSearchValueChanged($event)
                "
        (emitLoadMoreSearchResults)="
                    onChildLoadMoreSearchResults($event)
                " />
      }
    </div>
    }
  </div>

  <div class="side-container">
    <button
      mat-icon-button
      (click)="onRemovePropertyFormClicked(propertyFormItem)"
      class="remove-property-button remove">
      <mat-icon>remove_circle</mat-icon>
    </button>
  </div>
</div>
