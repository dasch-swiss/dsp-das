@if (projectsList && !isLoading) {
<div>
  <!-- header toolbar -->
  <div style="display: flex; align-items: center; padding: 16px; background-color: #f5f5f5">
    <span class="mat-headline-6" style="flex: 1; margin-bottom: 0">
      {{ projectsList.length | i18nPlural : itemPluralMapping['project'] }}
    </span>

    @if (isUserActive && createNewButtonEnabled && (isSysAdmin$ | async) === true) {
    <button mat-flat-button [color]="'primary'" (click)="createNewProject()">
      {{ 'pages.system.projectsList.createNew' | translate }}
    </button>
    }

    <app-sort-button
      [icon]="'sort_by_alpha'"
      [sortProps]="sortProps"
      [activeKey]="sortBy"
      (sortKeyChange)="sortList($event)" />
  </div>
  <!-- content: projectsList -->
  <table [class.deactivated]="!isUserActive">
    @for (project of projectsList; track trackByFn($index, project); let last = $last) {
    <tr [class.no-border]="last" data-cy="project-row">
      <!-- logo -->
      <td style="padding: 0 16px">
        <mat-icon mat-list-icon>
          @if (isUserActive) {
          <span>assignment</span>
          } @if (!isUserActive) {
          <span>lock</span>
          }
        </mat-icon>
      </td>
      <td style="width: 100%; padding: 16px 0; cursor: pointer">
        <div class="mat-subtitle-1" style="margin-bottom: 0" (click)="openProjectPage(project.id)">
          {{ project.longname }}
        </div>
        <div class="mat-subtitle-2" (click)="openProjectPage(project.id)">
          {{ project.shortcode }} | {{ project.shortname }}
        </div>
      </td>
      <td>
        @if (userIsProjectAdmin$(project.id) | async) {
        <mat-chip-listbox>
          <mat-chip>{{ 'pages.system.projectsList.projectAdmin' | translate }}</mat-chip>
        </mat-chip-listbox>
        }
      </td>
      <!-- action: menu with edit, remove, etc. -->
      <td>
        <button
          mat-icon-button
          [matMenuTriggerFor]="projectMenu"
          [disabled]="(userHasPermission$(project.id) | async) === false || systemProjects.includes(project.id)"
          data-cy="more-button">
          <mat-icon>more_horiz</mat-icon>
        </button>
        <mat-menu #projectMenu="matMenu" xPosition="before">
          @if (isUserActive) {
          <button mat-menu-item (click)="editProject(project.id)" data-cy="edit-button">
            {{ 'pages.system.projectsList.edit' | translate }}
          </button>
          } @if (isUserActive) {
          <button
            mat-menu-item
            (click)="askToDeactivateProject(project.shortname, project.id)"
            data-cy="deactivate-button">
            {{ 'pages.system.projectsList.deactivate' | translate }}
          </button>
          } @if (allowEraseProject && (isSysAdmin$ | async)) {
          <button mat-menu-item (click)="askToEraseProject(project)" data-cy="erase-button">
            {{ 'pages.system.projectsList.erase' | translate }}
          </button>
          } @if (!isUserActive) {
          <button
            mat-menu-item
            (click)="askToActivateProject(project.shortname, project.id)"
            data-cy="reactivate-button">
            {{ 'pages.system.projectsList.reactivate' | translate }}
          </button>
          }
        </mat-menu>
      </td>
    </tr>
    }
  </table>
</div>
}
