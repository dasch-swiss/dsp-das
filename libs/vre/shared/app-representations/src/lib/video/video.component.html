<div class="player" appDisableContextMenu [class.cinema]="cinemaMode">
  <div class="container">
    <!-- in case of an error -->
    <app-status [comment]="videoError" [url]="src.fileValue.fileUrl" [representation]="'video'" *ngIf="videoError" />

    <div class="video-container">
      <video
        class="video"
        #videoEle
        id="video"
        *ngIf="video; else loading"
        [src]="video"
        type="video/mp4"
        preload="auto"
        [muted]="false"
        (canplay)="onVideoPlayerReady()"
        (click)="videoPlayer.togglePlay()"
        (timeupdate)="timeUpdate()"
        (loadedmetadata)="loadedMetadata()"
        (canplaythrough)="loadedVideo()"
        (error)="handleVideoError($event)"></video>

      <div class="overlay">
        <div>
          <mat-icon (click)="updateTimeFromButton(-10)">replay_10</mat-icon>
          <mat-icon (click)="videoPlayer.togglePlay()">{{ play ? 'pause' : 'play_arrow' }}</mat-icon>
          <mat-icon (click)="updateTimeFromButton(10)">forward_10</mat-icon>
        </div>
      </div>

      <app-video-toolbar *ngIf="fileInfo" [src]="src" [parentResource]="parentResource" [fileInfo]="fileInfo" />
    </div>

    <div class="preview-line">
      <div class="preview" #preview>
        <app-video-preview [src]="src" [time]="previewTime" [fileInfo]="fileInfo" (loaded)="displayPreview(!$event)" />
      </div>
    </div>
  </div>

  <mat-toolbar class="controls">
    <mat-toolbar-row style="overflow: hidden">
      <app-av-timeline
        #timeline
        [value]="currentTime"
        [min]="0"
        [max]="duration"
        [resized]="cinemaMode"
        (move)="updatePreview($event)"
        (mouseenter)="displayPreview(true)"
        (dimension)="timelineDimension = $event"
        (mouseleave)="displayPreview(false)"
        (changed)="videoPlayer.navigate($event)"
        [disabled]="!videoEle" />
    </mat-toolbar-row>
  </mat-toolbar>
</div>

<app-segments-display
  *ngIf="segmentsService.segments.length > 0 && duration > 0"
  [segments]="segmentsService.segments"
  [videoLengthSecs]="duration" />

<ng-template #loading>
  <dasch-swiss-app-progress-indicator />
</ng-template>
